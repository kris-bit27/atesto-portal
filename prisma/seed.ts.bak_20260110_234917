import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

function slugify(input: string) {
  return input
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")     // pryÄ diakritika
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")         // mezery + znaky -> -
    .replace(/^-+|-+$/g, "")             // trim -
    .replace(/--+/g, "-");               // vÃ­cenÃ¡sobnÃ© -
}

async function main() {
  console.log("ðŸŒ± Seeduji Atesto portÃ¡l (clean slugs)â€¦");

  await prisma.question.deleteMany();
  await prisma.topic.deleteMany();

  const topicA1 = await prisma.topic.create({
    data: {
      title: "ObecnÃ¡ plastickÃ¡ chirurgie, vrozenÃ© vady",
      slug: "a1-obecna-plasticka-chirurgie",
      order: 1,
    },
  });

  const questions = [
    "Anatomie ruky a hornÃ­ konÄetiny",
    "Anatomie bÃ©rce a nohy",
    "LymfatickÃ½ systÃ©m a lymfedÃ©m",
    "FyziologickÃ© operovÃ¡nÃ­, magnifikace, turniket, implantÃ¡ty, psychologie",
    "TromboembolickÃ¡ prevence (DVT / PE)",
    "MÃ­stnÃ­ a svodnÃ¡ anestezie v plastickÃ© chirurgii",
    "HojenÃ­ ran, krytÃ­ ran, jizvy",
    "KoÅ¾nÃ­ transplantace",
    "AlogennÃ­ transplantace (VCA)",
    "Lipofilling a tkÃ¡ÅˆovÃ¡ expanze",
    "Laloky â€“ klasifikace, perforÃ¡tory, angiosomy, delay",
    "MÃ­stnÃ­, regionÃ¡lnÃ­ a vzdÃ¡lenÃ© laloky",
    "VolnÃ© laloky, non-reflow, monitoring",
    "PerifernÃ­ nervy â€“ sutury, Å¡tÄ›py, vodiÄe, neuromy",
  ];

  for (const title of questions) {
    await prisma.question.create({
      data: {
        topicId: topicA1.id,
        title,
        slug: slugify(title),
        status: "DRAFT",
        contentHtml: "",
      },
    });
  }

  console.log("âœ… Seed hotovÃ½.");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
